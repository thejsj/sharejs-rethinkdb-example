<html>
  <head>
    <title>Ace Editor - ShareJS and RethinkDB</title>
    <meta charset="utf-8">
    <style>
    #editor {
        position: absolute;
        width: 500px;
        height: 400px;
    }
    </style>
    <link href='lib/ace/lib/ace/theme/solarized_dark.css' rel="stylesheet"/>
  </head>
  <body>
    <textarea id="editor"></textarea>
    <script src="/lib/json0.js"></script>
    <script src="/lib/text.js"></script>
    <script src="/lib/ace.js"></script>
    <script src="/lib/share.uncompressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/theme-solarized_dark.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
    <script>
    // Editor
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/solarized_dark");
    var JavaScriptMode = ace.require("ace/mode/javascript").Mode;
    editor.getSession().setMode(new JavaScriptMode());
    
    // ShareJS
    var ws = new WebSocket('ws://localhost:8005');
    var sjs = new window.sharejs.Connection(ws);
    var doc = sjs.get('documents', 'sharejs_example');
    doc.subscribe();
    doc.whenReady(function () {
        console.log('Doc Ready:');
        /**
         * For some reason, doc.type comes out as undefined, even though it's
         * there if we console.log the whole object or console.log the keys
         *
         * In order to fix this, we just have a setTimeout
         */
        setTimeout(function () {
            console.log(doc);
            console.log(doc.attachCodeMirror);
            console.log(doc.attach_ace);
            if (!doc.type) {
              doc.create('text');
            }
            if (doc.type && doc.type.name === 'text') {
              doc.attach_ace(editor);
            }
        });
    });  
    </script>
  </body>
</html>
